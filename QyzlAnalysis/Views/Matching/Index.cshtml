@{
    Layout = null;
}
@using QyzlAnalysis.Models;
<script src="../../Scripts/jquery-1.5.1.min.js" type="text/javascript"></script>
<link href="../../style/base.css" rel="stylesheet" type="text/css" />
<link type="text/css" rel="stylesheet" href="../../style/user.css">
<link href="../../style/divIframe.css" rel="stylesheet" type="text/css" />
<script src="../../js/pager.js" type="text/javascript"></script>
<script type="text/javascript">
    var pager = @ViewData["pagerIndex"]
    var tatol = @ViewData["Total"]
    var TotalPager = @ViewData["TotalPager"]
    $(function(){
       $("#computerVal").click(function () {
            var chk = [];
            if($("input[name='krval']:checked").length == 2){

                $("input[name='krval']:checked").each(function(){
                    chk.push($(this).val()+"_"+$("#"+$(this).val()+"k").val()+"_"+$("#"+$(this).val()+"r").val())
                })
            }
            if(chk.length > 0){
            $.ajax({
                type:"post",
                url:"../Matching/computerS",
                data:{"krval":chk.join(",")},
                dataType:"html",
                success :function(result){
                    var str = result.split("_")
                    $("#uls").append('<li>'+str[0]+'s=<input type="text" value="'+str[1]+'" class="sval"></li>');
                }
            })}else{
                alert("请选择2条数据")
                return false;
            }
        })
        $("#computerSum").click(function(){
            var timeIndex = 0;
            var sum = 0;
            $(".sval").each(function(){
                var num =parseFloat($(this).val());
                sum+=num;
                timeIndex++
            })
            if(timeIndex!=0){
                $("#sumval").val(sum/timeIndex)
            }else{
                alert("未选择数据")
                return false;
            }
        })
        $(".delV").click(function(){
        if(confirm("确定删除！")){
            $.ajax({
                type:"post",
                url:"../Matching/DelFiles",
                data:{"Vid":$(this).attr("vid")},
                datatType:"json",
                success : function(jsobj){
                    alert(jsobj.msg)
                    location.href = "../Matching/Index"
                }
            })}else{
                return false;
            }
        })
    })
    function addInfomation(obj){
        if($(obj).attr('checked')){
                $.ajax({
                type:"post",
                url:"../Matching/rtnKr",
                data:{"matchid":$(obj).val()},
                dataType:"json",
                success : function(result){
                    var strconn = "";
                    $(result).each(function(){
                        strconn += '<tr id='+this.id+'><td><input type="checkbox" name="krval" value='+this.id+' />'+this.name+'</td><td><input type="text" id="'+this.id+'k" value="'+this.k+'" /></td><td><input id="'+this.id+'r" type="text" value="'+this.r+'" /></td></tr>'
                    })
                    $("#computerResult").append(strconn);
                }
            })
        }else{
            $("#"+$(obj).val()).remove();
        }
    }
    $(document).ready(function () {
        getLink(pager, TotalPager, tatol, "../Matching/Index", "middle", "pagerLink", "");
    })
</script>
<style type="text/css">
<!--
#pagerLink
{
    clear: both;
    overflow: hidden;
    padding: 20px;
    }
#pagerLink a,#pagerLink span{
    color: #515151;
    margin: 0 5px;
    }
    #pagerLink span
    {
        top: -2px;
        position: relative;
        }
#pagerLink a:hover
{
    color: rgb(121, 181, 227);
}

-->
</style>
<!--  rightArea  -->
<div class="rightArea fr oh">
    <div class="topNav oh"></div>
    <div class="clear"></div>
    <!--  container  -->
    <div class="container oh">
    
    	
        
    	<!--  formName 图表数据名称  -->
    	<div class="dateName">
        	<ul>
            	<li class="fl">
                	<h1 class="fl" id="editName">数据比较</h1>
            		<a href="#"><img src="../img/icon-edit.png" class="fl edit" onMouseOver="this.src='img/icon-edit-on.png'" onMouseOut="this.src='img/icon-edit.png'"></a>
                </li>
            </ul>
        </div>
    	<!--  formName 图表数据名称 end  -->
        <div class="clear"></div>
        
        <!--  dataContent  -->
        <div class="dataContent">
            <div class="dataForm">
            <table id="tbList" class="tc dataForm">
            <thead>
                <tr>
                <td>数据项/年份</td>
                @foreach (string y in (List<string>)ViewData["year_list"])
                {
                    <td>@y</td>
                    }
                    <td>操作</td>
                </tr>
            </thead>
            <tbody id="thtr">
               @foreach (KeyValuePair<string, List<string>> kv in (Dictionary<string, List<string>>)ViewData["rpeo"])
               {
                    <tr><td><input type='checkbox' name='cloumn' onclick="addInfomation(this)" value="@kv.Key.Substring(0, kv.Key.IndexOf("_"))" />@kv.Key.Substring(kv.Key.IndexOf("_")+1, kv.Key.Length - kv.Key.IndexOf("_")-1)</td>
                        @foreach (string s in kv.Value) { 
                            <td>@s</td>
                        }
                        <td><a class="delV" href="#" vid="@kv.Key.Substring(0, kv.Key.IndexOf("_"))">删除</a></td>
                    </tr>
               }
            </tbody>
            </table></div>
            <div id="pagerLink"></div>
        	<!--  dataForm 表格数据  -->
        	<div class="dataForm oh tc">
                
            	<table class="dataForm tc">
                	<thead>
                    	<tr>
                            <td>数据**名称</td>
                            <td>K</td>
                            <td>R</td>
                		</tr>
                    </thead>
                    <tbody id="computerResult">
                    	
                    </tbody>
                </table>
                <div class="clear"></div>
                
                <!--  operate 操作 -->
                <div class="operate oh mt10">
                    <a href="#" id="computerVal"><img src="../img/btn-count-value.png"></a>
                    <a href="#"><img src="../img/btn-empty-gray.png"></a>
                </div>
                <!--  operate 操作 end  -->
                <div class="clear"></div>
                
                <div class="dataCompare">
                    <ul id="uls">
                    </ul>
                </div>
                <div class="clear"></div>
                
                <!--  operate 操作 -->
                <div class="operate oh mt10">
            		<a href="#" id="computerSum"><img src="../img/btn-count-total.png"></a>
                </div>
                <!--  operate 操作 end  -->
               
                
                
                <div class="dataCompare">
                    s=<input type="text" id = "sumval">
                </div>
                
                
            
            </div>
            <!--  dataForm 表格数据  -->
        	<div class="clear"></div>
            
            
            
            
        
        </div>
        <!-- dataContent end  -->
        <div class="clear"></div>
        
        
        
    
    	
    </div>
    </div>